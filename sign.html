<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>التسجيل</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAB4wO937rCwc0OTWeJlGgoaxErWOdjaJM",
            authDomain: "my-new-a6e9f.firebaseapp.com",
            databaseURL: "https://my-new-a6e9f-default-rtdb.firebaseio.com",
            projectId: "my-new-a6e9f",
            storageBucket: "my-new-a6e9f.firebasestorage.app",
            messagingSenderId: "1034729064842",
            appId: "1:1034729064842:web:5b3d42fe7b5c0f3a3ae073"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        window.registerUser = function () {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const messageBox = document.getElementById("message-box");

            get(ref(db, "allowedUsers/" + btoa(email))).then((snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    if (password === userData.password) {
                        createUserWithEmailAndPassword(auth, email, password)
                            .then(() => {
                                messageBox.innerText = "✅ تم إنشاء الحساب بنجاح! جاري التوجيه...";
                                messageBox.style.color = "green";
                                setTimeout(() => {
                                    window.location.href = "https://dataenty.github.io/main/main.html";
                                }, 2000);
                            })
                            .catch((error) => {
                                messageBox.innerText = "❌ خطأ: " + error.message;
                                messageBox.style.color = "red";
                            });
                    } else {
                        messageBox.innerText = "❌ كلمة المرور غير صحيحة!";
                        messageBox.style.color = "red";
                    }
                } else {
                    messageBox.innerText = "❌ هذا البريد غير مسموح له بالتسجيل!";
                    messageBox.style.color = "red";
                }
            });
        };
    </script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f4f4f4; padding: 50px; }
        .register-container { background: white; padding: 20px; width: 350px; margin: auto; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); border-radius: 5px; }
        input, button { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        button { background-color: #28a745; color: white; cursor: pointer; }
        button:hover { background-color: #218838; }
        #message-box { font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="register-container">
        <h2>التسجيل</h2>
        <input type="email" id="email" placeholder="📧 البريد الإلكتروني" required>
        <input type="password" id="password" placeholder="🔒 كلمة المرور" required>
        <button onclick="registerUser()">تسجيل</button>
        <p id="message-box"></p>
    </div>
</body>
</html>
